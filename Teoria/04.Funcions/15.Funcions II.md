# Funcions en Bash II

## Retorn de valors

- Enviar informació des de la funció cap al programa principal.  

- 2 sistemes

    - Paraula clau `return` (limitat).  

    - Sortida stàndard.  

### “Return” número.  

En Bash, `return` només retorna un enter 0–255 (mòdul 256).

```bash

es_parell() {
  local n=$1
  (( n % 2 == 0 ))
  return $?   # 0 si true, 1 si false
}

es_parell 10

echo $?   

```

Limitacions importants:

* Rang 0–255 (si fas `return 300`, realment torna 44).  

* No serveix per retornar números grans, strings o estructures.  

* S’utilitza per “èxit/fracàs” (estil Unix).

### Sortida stàndard.  

La manera habitual de “retornar un valor” és imprimir-lo i capturar-lo:

```bash

suma() {
  echo $(( $1 + $2 ))
}

r=$(suma 3 7)
echo "$r"   

```

Punt crític: stdout ha de ser “net”. Si fas debug amb `echo`, contamines el valor.

Solució: envia logs a stderr:

```bash
suma() {
  echo "sumant $1 i $2" >&2
  echo $(( $1 + $2 ))
}
```

---

## Crida i control d’errors

Patró recomanat: dades per stdout, errors amb exit status + missatge a stderr.

```bash

divideix() {

  local a=$1 b=$2

  if [ $b = 0 ]
  then
    echo "Error: divisió per zero" >&2
    return 2
  fi

  echo $(( a / b ))
}

q=$(divideix 10 2) || { echo "ha fallat ($?)"; exit 1; }
echo "quocient=$q"

```

### Exercici

```bash

#!/bin/bash
divideix() {

  local a=$1 b=$2

  if [ $b = 0 ]
  then
    echo "Error: divisió per zero" >&2
    return 2
  fi

  echo $(( a / b ))
}

q=$(divideix 10 2) || { echo "ha fallat ($?)"; exit 1; }
echo "quocient=$q"

```
1. Explica el significat de la següent sentència 

`q=$(divideix 10 2) || { echo "ha fallat ($?)"; exit 1; }`

1. Provoca una divisió per zero. 

1. Quin és el resultat de l'execució de dividir per zero.   


---

## 6) “Passar per referència” (el truc) i limitacions

Bash no té referències de debò, però pots simular-ho.

### Opció 1: variable global (simple però bruta)

```bash
res=""
suma_global() { res=$(( $1 + $2 )); }
suma_global 2 5
echo "$res"
```

